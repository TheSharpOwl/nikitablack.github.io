<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"  lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1"/>

<title>Vulkan by example 0. Introduction. | Here should be the blog Title</title>



<link href="http://nikitablack.github.io/index.xml" rel="alternate" type="application/rss+xml" title="Here should be the blog Title" />

<link rel="stylesheet" href="/css/style.css"/>
<link rel="stylesheet" href="/css/css_lightbox.css"><link rel='stylesheet' href='http://nikitablack.github.io/css/custom.css'><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
<link rel="canonical" href="http://nikitablack.github.io/post/vulkan_by_example_0_introduction/">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
</head>
<body>

<section class="section">
  <div class="container">
    <nav id="nav-main" class="nav">
      <div id="nav-name" class="nav-left">
        <a id="nav-anchor" class="nav-item" href="http://nikitablack.github.io/">
          <h1 id="nav-heading" class="title is-4">Here should be the blog Title</h1>
        </a>
      </div>
      <div class="nav-right">
        <nav id="nav-items" class="nav-item level is-mobile"><a class="level-item" aria-label="twitter" href='https://twitter.com/nikita_cherniy'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="github" href='https://github.com/nikitablack'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
    
  </svg></i>
            </span>
          </a><a class="level-item" aria-label="email" href='mailto:mynameisnikitablack@gmail.com'
            target='_blank' rel='noopener'>
            <span class="icon">
              <i class><svg viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
    
    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
    <polyline points="22,6 12,13 2,6"/>
    
  </svg></i>
            </span>
          </a></nav>
      </div>
    </nav>

    <nav class="nav">
      

      
    </nav>

  </div>
  <script src="/js/navicon-shift.js"></script>
</section>
<section class="section">
  <div class="container">
    <div class="subtitle tags is-6 is-pulled-right">
      
    </div>
    <h2 class="subtitle is-6">January 5, 2022</h2>
    <h1 class="title">Vulkan by example 0. Introduction.</h1>
    
    <div class="content">
      <p>Hi everybody. Today I&rsquo;d like to talk about <code>Vulkan</code> - the modern API for communication with a GPU device. Though there&rsquo;re already lots of information and tutorials on the web as well as books I want to try to write about the API for several reasons:</p>
<ul>
<li>I don&rsquo;t want this series to be about general usage of the API. Instead, I want to focus on a single purpose application, more or less <em>advanced</em>, <em>not</em> a triangle, and explain how all works by looking at a concrete example.</li>
<li>I want to understand <code>Vulkan</code> better. And, as you know, trying to explain things helps to understand them better.</li>
</ul>
<p>I recommend to start my tutorials after you finish <a href="https://vulkan-tutorial.com/">vulkan tutorial</a> and/or <a href="https://software.intel.com/en-us/articles/api-without-secrets-introduction-to-vulkan-preface">API without Secrets</a>. These resources greatly explain the API usage and after reading them you should have a solid understanding what <code>Vulkan</code> is. So if you didn&rsquo;t read them, take a pause and follow the links. See you next year!</p>
<p>For those who already have an understanding of what <code>Vulkan</code> is I&rsquo;ll try to continue to build a mental picture around the API, to understand why do we need every bit of code, every structure we used. I’ll build every next lesson on top of the previous by <em>adding</em> new stuff, but without modifying the old - I found it easier to follow. Though this rule is not strict and sometimes I’ll have to return back and change the existing code, but I’ll try to minimize it. And yes, I’ll use pictures, a lot of them.</p>
<p>This is my third attempt to write Vulkan tutorials. First, when I started I wanted to describe every single detail of the API, like every field of every struct I used. You can imagine the amount of information I had to cover. Since I wanted to finish before I&rsquo;m 90 and since the Holy Specification explains it better I decided to drop the idea. In my second attempt, I tried to duplicate the code in the article so a reader doesn&rsquo;t need to jump to another page that often but I had to drop that idea too - since even a simple triangle takes more than 1000 LOC you can imagine the amount of text I had to put in every article. So instead I&rsquo;ll use links to the code on <code>Github</code> - this saves a lot of space and does not require updating an article in case the code changes. If you find this not very comfortable <del>buy a second monitor</del> you can split a browser window. Also, I&rsquo;ll not post links to the specification because <code>a</code> - spec changes and <code>b</code> - it&rsquo;s very easy to search. Simply navigate to a spec version you&rsquo;re interested in, for example <a href="https://www.khronos.org/registry/vulkan/specs/1.1-khr-extensions/html/">here&rsquo;s the link</a> for the Vulkan 1.1 specification with extensions, type the term you&rsquo;re searching for and enjoy.</p>
<blockquote>
<p><strong>Disclaimer:</strong> I&rsquo;m not an expert guru ninja, I&rsquo;m learning. And definitely, there will be mistakes in my lessons. I&rsquo;m kindly asking you to point to them so I can fix them soon. You can find me on <a href="https://twitter.com/nikita_cherniy">twitter</a>, or even better - create an issue on <a href="https://github.com/nikitablack">github</a>.</p>
</blockquote>
<h2 id="the-goal">The goal</h2>
<p>This is our goal:</p>

<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube.com/embed/8RCWeKLlVew" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>

<p>The rotating teapot! Amazing, isn&rsquo;t it? Sorry for the blurriness - youtube mercilessly messed up with quality and I don&rsquo;t know how to fix it. As you can see, the application uses tesselation to change the geometry detail. It can be rendered in solid or wireframe mode. I chose it because it covers a lot of pipeline stages so I have to touch a great number of different parts of the API, which is good. I did it before with <a href="http://nikitablack.github.io/post/directx_12_by_example/">DirectX 12</a>, so I already have some ideas on how to start.</p>
<h2 id="what-will-not-be-in-the-tutorials">What will not be in the tutorials</h2>
<p>In addition to general graphics concepts, I assume you know what tesselation is, why there are two related stages in the pipeline (tesselation control and tesselation evaluation), so I&rsquo;ll not explain that in detail. The same goes for curved surfaces - if you need to refresh your memory I recommend <a href="http://www.gamasutra.com/view/feature/131755/curved_surfaces_using_bzier_.php">this Gamasutra article</a>. I&rsquo;ll not explain the math behind projection and other transformation matrices as well. Also, I assume you already have <code>Vulkan</code> SDK installed, have all required environment variables set and know how to use CMake.</p>
<h2 id="code-organization">Code organization</h2>
<p>I use <code>CMake</code> as a building tool. I test my code on <code>Windows 10</code> and <code>Ubuntu 18.04</code>. On <code>Linux</code> I use <code>CLion</code> (it have nice <code>CMake</code> integration) with <code>gcc</code>, on <code>Windows</code> - <code>Visual Studio Community 2017</code> which supports <code>CMake</code> as well. Also <code>c++17</code> is my choice.</p>
<pre tabindex="0"><code>lesson/
├──src/
│   ├──teapot/
│   │   ├──resources/
│   │   ├──src/
│   │   │   ├──utils/
│   │   │   │  └──...
│   │   │   ├──vulkan/
│   │   │   │  └──...
│   │   │   ├──window/
│   │   │   │  └──...
│   │   │   ├──AppData.h
│   │   │   ├──Global.h
│   │   │   ├──main.cpp
│   │   │   └──TeapotData.h
│   │   └──CMakeLists.txt
│   └──third_party/
│       ├──eigen/
│       │   └──CMakeLists.txt
│       ├──glfw-3.2.1/
│           └──CMakeLists.txt
└──CMakeLists.txt
</code></pre><p>This is a typical project structure for each lesson. <code>resources/</code> folder holds shader files. I chose <code>glsl</code> as a shading language, though <code>Vulkan</code> does not require it. The geometry data is stored in the <code>TeapotData</code> structure. Also, there&rsquo;re some global variables - I&rsquo;m not a big fan of it, but the window library forces to use them. For window creation and management I use <a href="http://www.glfw.org/"><code>glfw</code></a> - it&rsquo;s simple and cross-platform. It has Vulkan support and greatly simplifies some parts. For math, I use <a href="http://eigen.tuxfamily.org/index.php"><code>eigen</code></a> instead of commonly used <code>glm</code> simply because I&rsquo;m more familiar with it. Also, I organize the code in a functional style. I dedicated an entire <a href="http://nikitablack.github.io/post/how_i_organize_data_in_functional_style/">article</a> to explain how this works so if you didn&rsquo;t read it you can do it now to understand why my code looks so strange.</p>
<h2 id="the-data">The data</h2>
<p>One of the first <a href="https://www.sjbaker.org/wiki/index.php?title=The_History_of_The_Teapot">links</a> in Google offers us a nice teapot dataset. Though it looks good it requires some processing - if we use it as it is we&rsquo;ll not get a complete model:</p>
<a href="#images%2f1.png">
    <img src=images/1.png class="thumbnail">
</a>
</br>
  

<a href="#_" class="lightbox" id="images/1.png">
  <img src=images/1.png>
</a>
<p>The initial data describes only a fraction of the teapot and some parts have to be duplicated - the body part has to be rendered with rotation and the handle and the spout have to be mirrored to get a closed form. This can be achieved in multiple ways - with instancing, with data duplication, etc. I chose to keep control points fixed and duplicate indices. For example, the rim patch is presented by 16 indices (the dataset uses 16-point patches) - <code>102, 10, 104, 105, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15</code> - and represents the quarter of the teapot rim. So I added the same indices 3 more times to the patches vector. But as you can guess just copying the indices will not work - I&rsquo;ll end up rendering the same patch in the same place. That&rsquo;s why I have to introduce another collection with patch transformations. Now the original rim patch will be rendered with identity transform, the next one - with 90 degrees rotation, the third one - with 180 degrees rotation, and the last one with 270 degrees rotation to enclose the surface completely. For mirrored parts it&rsquo;s a little bit trickier - if I just make a copy of indices and a use a mirror matrix (which is a scale matrix with -1 along the mirror axis) - the winding order will change. On the following picture I tried to visualize the problem:</p>
<a href="#images%2f2.jpg">
    <img src=images/2.jpg class="thumbnail">
</a>
</br>
  

<a href="#_" class="lightbox" id="images/2.jpg">
  <img src=images/2.jpg>
</a>
<p>Here the right triangle&rsquo;s face points in the positive <code>x</code> direction. Clockwise indices are <code>1-2-3</code>. Now if I want the mirrored triangle to face the negative <code>x</code> direction, I can&rsquo;t use <code>1-2-3</code> anymore - I need to change the order to <code>1-3-2</code> (or change the winding order to counter-clockwise, which I don&rsquo;t want to do since that would require a pipeline change). That&rsquo;s why I decided to tweak indices if I use a mirror matrix.</p>
<p>All the data is stored in the <a href="https://github.com/nikitablack/vulkan_by_example_2/blob/lesson_0/src/teapot/src/TeapotData.hpp"><code>TeapotData</code></a> file - 28 patches in total. For visualization, I also added a vector with colors - one color per patch. Later in a shader, I&rsquo;ll use patch id (kindly provided by the runtime) to sample transforms and colors and apply changes to the corresponding patch.</p>
<h2 id="the-beginning">The beginning</h2>
<p><a href="https://github.com/nikitablack/vulkan_by_example_2/blob/lesson_0/src/teapot/src/AppData.hpp"><code>AppData</code></a> is a state holder. In this first tutorial, it&rsquo;s almost empty. This structure will be passed to various functions as described in the <a href="http://nikitablack.github.io/post/how_i_organize_data_in_functional_style/">earlier article</a>.</p>
<p>The <a href="https://github.com/nikitablack/vulkan_by_example_2/blob/lesson_0/src/teapot/src/main.cpp#L9">main.cpp</a> file starts with global variables initialization. Indeed globals are bad but here&rsquo;s the deal: <code>glfw</code> library, which I use for window management, uses callbacks for communication. For example, <code>glfwSetKeyCallback</code> calls user-provided function on a keyboard press. The callback defined in <a href="https://github.com/nikitablack/vulkan_by_example_2/blob/lesson_0/src/teapot/src/window/on_key_press.cpp">on_key_press.cpp</a> file. There&rsquo;s no way to move my <code>AppDataPtr</code> to that function. It is still possible to pass data around with <code>glfwSetWindowUserPointer</code> and <code>glfwGetWindowUserPointer</code>, but that breaks the agreement of a <em>single-unique-pointer</em>. So I decided to go with global variables. For now, there are not many of them and all they declared <a href="https://github.com/nikitablack/vulkan_by_example_2/blob/lesson_0/src/teapot/src/Global.hpp">here</a>.</p>
<p>The <a href="https://github.com/nikitablack/vulkan_by_example_2/blob/lesson_0/src/teapot/src/main.cpp#L33"><code>main</code></a> function defines <code>appData</code> variable which is immediately passed to <a href="https://github.com/nikitablack/vulkan_by_example_2/blob/lesson_0/src/teapot/src/window/create_window.cpp">create_window</a> function. Here the <code>glfw</code> stuff happens, if you want to know more, please refer to the <a href="https://www.glfw.org/docs/latest/quick.html">documentation</a>. Inside the function, the <code>appData</code> updated with a newly created window and multiple callbacks are set up. <a href="https://github.com/nikitablack/vulkan_by_example_2/blob/lesson_0/src/teapot/src/window/on_key_press.cpp">on_key_press</a> you already know: on <code>+</code> the tesselation level increases, on <code>-</code> - decreases, <code>space</code> changes the rendering mode. Here the aforementioned global variables get updated.</p>
<blockquote>
<p><strong>Note:</strong> The maximum tesselation level depends on a GPU and can be requested at runtime. It&rsquo;s too early to speak about it right now, but what is important to know is that the specification guarantees certain values limits for certain GPU properties. <code>maxTessellationGenerationLevel</code>, for example, is guaranteed to be in the range 0 to 64.</p>
</blockquote>
<p><a href="https://github.com/nikitablack/vulkan_by_example_2/blob/lesson_0/src/teapot/src/window/framebuffer_size_callback.cpp">framebuffer_size_callback</a> will be called on window resize and will set the global variable to a proper state.</p>
<p>Back to <a href="https://github.com/nikitablack/vulkan_by_example_2/blob/lesson_0/src/teapot/src/main.cpp#L45">main</a>. After the window creation (if it didn&rsquo;t fail) the <em>infinite</em> loop starts. Of course, it&rsquo;s not <em>that</em> infinite - it will be stopped as soon as the window is closed and after that happens everything should be cleared - we don&rsquo;t want to leave the garbage after the party. For now, we just terminate <code>glfw</code>.</p>
<p>In short, this is the main interface of the application:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp">appData <span style="color:#555">=</span> create_window(std<span style="color:#555">::</span>move(appData));</code></pre></div>
<p>For now, it&rsquo;s a single function call but it will grow with every new lesson.</p>
<h2 id="conclusion">Conclusion</h2>
<p>The entire article and no any single <code>Vulkan</code> related line of code! Sorry for that, it was a necessary long indroduction but I promise - in the next lesson we&rsquo;ll start the real work.</p>
<p>The source code for this lesson is <a href="https://github.com/nikitablack/vulkan_by_example/tree/lesson_0">here</a>.</p>
      
      <div class="related">
</div>
      
    </div>
    
  </div>
</section>



<section class="section">
  <div class="container has-text-centered">
    <p>If you like what I do you can <a href="https://www.buymeacoffee.com/nikitablack">buy me a coffee</a> &copy; <a href="http://nikitablack.github.io/">nikitablack</a> 2021</p>
    
      <p>Powered by <a href="https://gohugo.io/">Hugo</a> &amp; <a href="https://github.com/ribice/kiss">Kiss</a>.</p>
    
  </div>
</section>



</body>
</html>

